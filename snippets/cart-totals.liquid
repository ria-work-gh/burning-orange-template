{%- comment -%}
  Cart checkout summary: discounts, subtotal, shipping note, terms, checkout button.

  Usage:
    {% render 'cart-totals', cart: cart %}
{%- endcomment -%}

<div class="cart-summary">
  {%- if cart.discount_applications.size > 0 -%}
    {%- for discount in cart.discount_applications -%}
      <div class="cart-discount-block">
        <div class="cart-discount-row">
          <span>
            {{- discount.title -}}
            {%- if discount.value_type == 'percentage' %}&nbsp;Â· {{ discount.value | floor }}% off{%- endif -%}
          </span>
          <span>-{{ discount.total_allocated_amount | money }}</span>
        </div>
        {%- comment -%} Show which line items received this discount {%- endcomment -%}
        {%- assign discount_products = '' -%}
        {%- for item in cart.items -%}
          {%- for allocation in item.discount_allocations -%}
            {%- if allocation.discount_application.title == discount.title -%}
              {%- unless discount_products contains item.product.title -%}
                {%- assign discount_products = discount_products | append: item.product.title | append: ', ' -%}
              {%- endunless -%}
            {%- endif -%}
          {%- endfor -%}
        {%- endfor -%}
        {%- if discount_products != '' -%}
          <span class="cart-discount-collections">{{ discount_products | remove_last: ', ' }}</span>
        {%- endif -%}
      </div>
    {%- endfor -%}
  {%- endif -%}

  <div class="cart-summary-row cart-subtotal">
    <span class="text-cap">{{ 'cart.general.subtotal' | t }}</span>
    <span>{{ cart.total_price | money }}</span>
  </div>

  <p class="cart-shipping-note">{{ 'cart.general.taxes_note' | t }}</p>

</div>

<a href="/checkout" class="button text-cap">{{ 'cart.general.checkout' | t }}</a>

<noscript>
  <button type="submit" class="button secondary">{{ 'cart.general.update' | t }}</button>
</noscript>

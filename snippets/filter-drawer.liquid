{%- comment -%}
  Filter drawer: left-slide panel with accordion filter groups, radio dot options,
  colour swatches, and a "View results" button.

  Uses Shopify's native collection.filters for storefront filtering.
  Each filter option links via value.url for navigation-based filtering.

  Expects:
    - collection: the current collection object

  Usage:
    {% render 'filter-drawer', collection: collection %}
{%- endcomment -%}

{%- liquid
  assign active_filter_count = 0
  for filter in collection.filters
    assign active_filter_count = active_filter_count | plus: filter.active_values.size
  endfor
-%}

<filter-drawer id="filter-drawer" aria-hidden="true" role="dialog" aria-modal="true" aria-label="{{ 'collections.filtering.filter_and_sort' | t }}">
  <div class="filter-overlay" data-overlay></div>

  <aside class="filter-panel">
    <div class="filter-header">
      <span class="filter-title text-cap">{{ 'collections.filtering.filter_and_sort' | t }}</span>
      <button class="filter-close text-cap" data-close aria-label="{{ 'collections.filtering.close' | t }}">
        {{ 'general.close' | t }}
      </button>
    </div>

    <div class="filter-body">
      {%- for filter in collection.filters -%}
        {%- if filter.type == 'price_range' -%}
          <details class="filter-dropdown">
            <summary class="filter-dropdown-summary text-medium">{{ filter.label }}</summary>
            <div class="filter-dropdown-content">
              <form class="filter-price-range" data-price-filter action="{{ collection.url }}" method="get">
                <div class="filter-price-field">
                  <input
                    class="input"
                    type="number"
                    name="{{ filter.min_value.param_name }}"
                    value="{{ filter.min_value.value }}"
                    placeholder="{{ 'collections.filtering.min' | t }}"
                    min="0"
                    max="{{ filter.range_max | money_without_currency }}"
                  >
                </div>
                <div class="filter-price-field">
                  <input
                    class="input"
                    type="number"
                    name="{{ filter.max_value.param_name }}"
                    value="{{ filter.max_value.value }}"
                    placeholder="{{ 'collections.filtering.max' | t }}"
                    min="0"
                    max="{{ filter.range_max | money_without_currency }}"
                  >
                </div>
              </form>
            </div>
          </details>
        {%- else -%}
          <details class="filter-dropdown">
            <summary class="filter-dropdown-summary text-medium">{{ filter.label }}</summary>
            <div class="filter-dropdown-content">
              {%- for value in filter.values -%}
                <a
                  href="{% if value.active %}{{ value.url_to_remove }}{% else %}{{ value.url_to_add }}{% endif %}"
                  class="filter-option{% if value.active %} selected{% endif %}{% if value.count == 0 and value.active == false %} disabled{% endif %}"
                  data-filter-link
                >
                  <span class="radio-custom"></span>
                  {%- if value.swatch.color -%}
                    <span class="filter-swatch" style="background-color: {{ value.swatch.color }};"></span>
                  {%- endif -%}
                  <span class="filter-option-label">{{ value.label }}</span>
                </a>
              {%- endfor -%}
            </div>
          </details>
        {%- endif -%}
      {%- endfor -%}
    </div>

    <div class="filter-footer">
      {%- if active_filter_count > 0 -%}
        <a href="{{ collection.url }}" class="filter-clear text-cap" data-clear-filters>{{ 'collections.filtering.clear' | t }}</a>
      {%- endif -%}
      <button class="button text-cap" data-close>
        {{ 'collections.filtering.view_results' | t: count: collection.products_count }}
      </button>
    </div>
  </aside>
</filter-drawer>

<script type="module" src="{{ 'filter-drawer.js' | asset_url }}"></script>

{% stylesheet %}
  /* Filter drawer overlay */
  filter-drawer {
    position: fixed;
    inset: 0;
    z-index: var(--z-drawer);
    pointer-events: none;
  }

  filter-drawer.is-open {
    pointer-events: auto;
  }

  .filter-overlay {
    position: absolute;
    inset: 0;
    background-color: var(--color-overlay);
    backdrop-filter: blur(var(--blur-md));
    -webkit-backdrop-filter: blur(var(--blur-md));
    opacity: 0;
    transition: opacity var(--transition-base);
  }

  filter-drawer.is-open .filter-overlay {
    opacity: 1;
  }

  /* Panel */
  .filter-panel {
    position: absolute;
    top: 0;
    left: 0;
    height: 100vh;
    width: 480px;
    max-width: 90vw;
    background: var(--color-background);
    display: flex;
    flex-direction: column;
    transform: translateX(-100%);
    transition: transform var(--transition-base);
  }

  filter-drawer.is-open .filter-panel {
    transform: translateX(0);
  }

  /* Header */
  .filter-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing-1);
  }

  .filter-title {
    font-size: var(--font-base-size);
  }

  .filter-close {
    font-size: var(--font-detail-size);
    line-height: 1;
    color: var(--color-text);
    opacity: 0.6;
    transition: opacity var(--transition-fast);
  }

  .filter-close:hover {
    opacity: 1;
  }

  /* Body */
  .filter-body {
    flex: 1;
    overflow-y: auto;
    padding: var(--spacing-3) var(--spacing-1) 0;
  }

  /* Dropdown accordion */
  .filter-dropdown + .filter-dropdown {
    border-top: 1px solid var(--color-text);
  }

  .filter-dropdown-summary {
    padding: var(--spacing-2) 0;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    text-align: left;
  }

  .filter-dropdown-summary::after {
    content: '+';
    font-size: var(--font-control-size);
  }

  .filter-dropdown[open] .filter-dropdown-summary::after {
    content: '\2212';
  }

  /* Filter options grid */
  .filter-dropdown-content {
    padding: 0 0 var(--spacing-2);
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-1);
    font-size: var(--font-base-size);
    line-height: var(--font-base-height);
  }

  /* Individual filter option */
  .filter-option {
    display: flex;
    align-items: center;
    gap: var(--spacing-1);
    padding: var(--spacing-1);
    transition: background-color var(--transition-base);
    color: inherit;
  }

  .filter-option:hover {
    background-color: var(--color-input-bg);
  }

  .filter-option.selected {
    background-color: var(--color-input-bg);
  }

  .filter-option.disabled {
    opacity: 0.4;
    pointer-events: none;
  }

  /* Radio dot */
  .radio-custom {
    width: 10px;
    height: 10px;
    border: 1px solid black;
    border-radius: 50%;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .radio-custom::after {
    content: '';
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: transparent;
    transition: background var(--transition-fast);
  }

  .filter-option.selected .radio-custom::after {
    background: black;
  }

  /* Colour swatch */
  .filter-swatch {
    width: 12px;
    height: 12px;
    border: 1px solid hsla(0, 0%, 0%, 0.1);
    flex-shrink: 0;
  }

  /* Price range */
  .filter-price-range {
    display: flex;
    gap: var(--spacing-1);
  }

  .filter-price-field {
    flex: 1;
  }

  .filter-price-field input {
    width: 100%;
    border-top: 1px solid black;
    border-bottom: 1px solid black;
    background-color: var(--color-input-bg);
    padding: var(--spacing-1);
  }

  /* Footer */
  .filter-footer {
    display: grid;
    gap: var(--spacing-1);
    padding: var(--spacing-1);
  }

  .filter-clear {
    font-size: var(--font-detail-size);
    color: var(--color-text);
    opacity: 0.6;
    transition: opacity var(--transition-fast);
  }

  .filter-clear:hover {
    opacity: 1;
  }


  /* Body scroll lock */
  body.filter-drawer-open {
    overflow: hidden;
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .filter-overlay,
    .filter-panel {
      transition: none;
    }
  }
{% endstylesheet %}

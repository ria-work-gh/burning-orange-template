{%- comment -%}
  Renders product media gallery with Embla carousel.
  Expects: product (product object)

  Single media: plain render, no carousel.
  Multi-media: Embla carousel with auto-width horizontal scroll.
{%- endcomment -%}

{%- if product.media.size == 1 -%}
  {%- assign media = product.media[0] -%}
  <div class="product-gallery product-gallery-single">
    <div class="product-gallery-slide-inner">
      {%- if media.media_type == 'image' -%}
        {{ media | image_url: width: 1200 | image_tag:
          loading: 'eager',
          alt: media.alt | default: product.title,
          width: media.width,
          height: media.height
        }}
      {%- elsif media.media_type == 'video' -%}
        {{ media | video_tag: autoplay: false, controls: true }}
      {%- elsif media.media_type == 'external_video' -%}
        {%- if media.host == 'youtube' -%}
          <iframe
            src="https://www.youtube.com/embed/{{ media.external_id }}?enablejsapi=1"
            allow="autoplay; encrypted-media"
            allowfullscreen
            loading="lazy"
            title="{{ media.alt | default: product.title }}"
          ></iframe>
        {%- elsif media.host == 'vimeo' -%}
          <iframe
            src="https://player.vimeo.com/video/{{ media.external_id }}"
            allow="autoplay; encrypted-media"
            allowfullscreen
            loading="lazy"
            title="{{ media.alt | default: product.title }}"
          ></iframe>
        {%- endif -%}
      {%- elsif media.media_type == 'model' -%}
        {{ media | model_viewer_tag }}
      {%- endif -%}
    </div>
  </div>

{%- elsif product.media.size > 1 -%}
  <product-gallery
    class="product-gallery"
    aria-roledescription="carousel"
    aria-label="{{ 'products.product.gallery_label' | t }}"
  >
    <div class="product-gallery-viewport">
      <div class="product-gallery-container">
        {%- for media in product.media -%}
          <div
            class="product-gallery-slide"
            role="group"
            aria-roledescription="slide"
            aria-label="{{ 'accessibility.slide_number' | t: number: forloop.index, total: product.media.size }}"
            {% unless forloop.first %}aria-hidden="true"{% endunless %}
            data-media-id="{{ media.id }}"
            data-media-type="{{ media.media_type }}"
          >
            <div class="product-gallery-slide-inner">
              {%- if media.media_type == 'image' -%}
                {{ media | image_url: width: 1200 | image_tag:
                  loading: forloop.first | ternary: 'eager', 'lazy',
                  alt: media.alt | default: product.title,
                  width: media.width,
                  height: media.height
                }}
              {%- elsif media.media_type == 'video' -%}
                {{ media | video_tag: autoplay: false, controls: true }}
              {%- elsif media.media_type == 'external_video' -%}
                {%- if media.host == 'youtube' -%}
                  <iframe
                    src="https://www.youtube.com/embed/{{ media.external_id }}?enablejsapi=1"
                    allow="autoplay; encrypted-media"
                    allowfullscreen
                    loading="lazy"
                    title="{{ media.alt | default: product.title }}"
                  ></iframe>
                {%- elsif media.host == 'vimeo' -%}
                  <iframe
                    src="https://player.vimeo.com/video/{{ media.external_id }}"
                    allow="autoplay; encrypted-media"
                    allowfullscreen
                    loading="lazy"
                    title="{{ media.alt | default: product.title }}"
                  ></iframe>
                {%- endif -%}
              {%- elsif media.media_type == 'model' -%}
                {{ media | model_viewer_tag }}
              {%- endif -%}
            </div>
          </div>
        {%- endfor -%}
      </div>
    </div>

    <div class="product-gallery-live-region visually-hidden" aria-live="polite" aria-atomic="true"></div>
  </product-gallery>
{%- endif -%}

{% stylesheet %}
  .product-gallery,
  .product-gallery-single {
    position: relative;
    display: block;
    height: 100%;
  }

  .product-gallery-single .product-gallery-slide-inner {
    height: 100%;
  }

  .product-gallery-single img,
  .product-gallery-single video {
    height: 100%;
    width: auto;
    display: block;
  }

  .product-gallery-single iframe {
    width: 100%;
    height: 100%;
    border: 0;
    display: block;
  }

  /* Embla essentials */
  .product-gallery-viewport {
    overflow: hidden;
    height: 100%;
  }

  .product-gallery-container {
    display: flex;
    height: 100%;
  }

  .product-gallery-slide {
    flex: 0 0 auto;
    min-width: 0;
    height: 100%;
    margin-right: var(--spacing-2);
  }

  .product-gallery-slide-inner {
    background-color: var(--color-input-bg);
    height: 100%;
  }

  .product-gallery-slide img {
    height: 100%;
    width: auto;
    display: block;
  }

  .product-gallery-slide video {
    height: 100%;
    width: auto;
    display: block;
  }

  .product-gallery-slide iframe {
    width: 100%;
    height: 100%;
    border: 0;
    display: block;
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .product-gallery-container {
      transition: none !important;
    }
  }
{% endstylesheet %}

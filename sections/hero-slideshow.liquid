<hero-slideshow
  class="hero-slideshow hero-slideshow-{{ section.settings.min_height }}"
  aria-roledescription="carousel"
  aria-label="{{ 'sections.slideshow.aria_label' | t }}"
  {% if section.settings.autoplay %}data-autoplay="{{ section.settings.autoplay_speed }}"{% endif %}
  data-pause-label="{{ 'sections.slideshow.pause' | t }}"
  data-play-label="{{ 'sections.slideshow.play' | t }}"
>
  <div class="hero-slideshow__viewport">
    <div class="hero-slideshow__container">
      {%- for block in section.blocks -%}
        <div
          class="hero-slideshow__slide"
          role="group"
          aria-roledescription="slide"
          aria-label="{{ 'accessibility.slide_number' | t: number: forloop.index, total: section.blocks.size }}"
          {% unless forloop.first %}aria-hidden="true"{% endunless %}
          {{ block.shopify_attributes }}
        >
          {%- if block.settings.video != blank -%}
            <div class="hero-slideshow__media">
              {{
                block.settings.video
                | video_tag:
                  image_size: '1920x',
                  autoplay: true,
                  loop: true,
                  muted: true,
                  class: 'hero-slideshow__video'
              }}
              {%- if block.settings.overlay_opacity > 0 -%}
                <div class="hero-slideshow__overlay" style="opacity: {{ block.settings.overlay_opacity | divided_by: 100.0 }};"></div>
              {%- endif -%}
            </div>
          {%- elsif block.settings.image -%}
            <div class="hero-slideshow__media">
              {{
                block.settings.image
                | image_url: width: 1920
                | image_tag:
                  loading: forloop.first | ternary: 'eager', 'lazy',
                  sizes: '100vw',
                  class: 'hero-slideshow__img',
                  width: block.settings.image.width,
                  height: block.settings.image.height
              }}
              {%- if block.settings.overlay_opacity > 0 -%}
                <div class="hero-slideshow__overlay" style="opacity: {{ block.settings.overlay_opacity | divided_by: 100.0 }};"></div>
              {%- endif -%}
            </div>
          {%- endif -%}

          <div class="hero-slideshow__card">
            <div class="hero-slideshow__content">
              {%- if block.settings.heading != blank -%}
                {%- if template.name == 'index' and forloop.first -%}
                  <h1 class="hero-slideshow__heading text-xl">{{ block.settings.heading }}</h1>
                {%- else -%}
                  <h2 class="hero-slideshow__heading text-xl">{{ block.settings.heading }}</h2>
                {%- endif -%}
              {%- endif -%}

              {%- if block.settings.subheading != blank -%}
                <p class="hero-slideshow__subheading">{{ block.settings.subheading }}</p>
              {%- endif -%}

              {%- if block.settings.button_text != blank and block.settings.button_link != blank -%}
                <div class="hero-slideshow__buttons">
                  <a
                    href="{{ block.settings.button_link }}"
                    class="button{% if block.settings.button_style == 'secondary' %} secondary{% endif %}"
                  >
                    {{ block.settings.button_text }}
                  </a>
                </div>
              {%- endif -%}
            </div>
          </div>
        </div>
      {%- endfor -%}
    </div>
  </div>

  {%- if section.blocks.size > 1 -%}
    <div class="hero-slideshow__controls">
      <div class="hero-slideshow__dots" role="tablist" aria-label="{{ 'sections.slideshow.navigation' | t }}">
        {%- for block in section.blocks -%}
          <button
            class="hero-slideshow__dot{% if forloop.first %} is-active{% endif %}"
            role="tab"
            aria-selected="{% if forloop.first %}true{% else %}false{% endif %}"
            aria-label="{{ 'accessibility.slide_number' | t: number: forloop.index, total: section.blocks.size }}"
            data-index="{{ forloop.index0 }}"
          ></button>
        {%- endfor -%}
      </div>

      {%- if section.settings.autoplay -%}
        <button
          class="hero-slideshow__pause"
          type="button"
          aria-label="{{ 'sections.slideshow.pause' | t }}"
        >
          <svg class="icon-pause" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <rect x="3" y="2" width="4" height="12" fill="currentColor"/>
            <rect x="9" y="2" width="4" height="12" fill="currentColor"/>
          </svg>
          <svg class="icon-play" width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <polygon points="3,2 14,8 3,14" fill="currentColor"/>
          </svg>
        </button>
      {%- endif -%}
    </div>

    <div class="hero-slideshow__live-region visually-hidden" aria-live="polite" aria-atomic="true"></div>
  {%- endif -%}
</hero-slideshow>

{% stylesheet %}
  .hero-slideshow {
    position: relative;
    display: block;
  }

  .hero-slideshow__viewport {
    overflow: hidden;
  }

  .hero-slideshow__container {
    display: flex;
  }

  .hero-slideshow__slide {
    position: relative;
    display: flex;
    align-items: flex-end;
    justify-content: flex-start;
    padding: var(--spacing-base);
    flex: 0 0 100%;
    min-width: 0;
    background-color: #e5e5e5;
  }

  .hero-slideshow-small .hero-slideshow__slide {
    min-height: 40vh;
  }
  .hero-slideshow-medium .hero-slideshow__slide {
    min-height: 60vh;
  }
  .hero-slideshow-large .hero-slideshow__slide {
    min-height: 80vh;
  }
  .hero-slideshow-full .hero-slideshow__slide {
    min-height: calc(100svh - var(--header-height, 0px));
  }

  .hero-slideshow__media {
    position: absolute;
    inset: 0;
  }

  .hero-slideshow__media img,
  .hero-slideshow__media video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .hero-slideshow__overlay {
    position: absolute;
    inset: 0;
    background: black;
  }

  .hero-slideshow__card {
    position: relative;
    z-index: 1;
    width: 100%;
    background: white;
    color: black;
    padding: var(--spacing-base);
    border-radius: 0;
  }

  .hero-slideshow__content {
    text-align: left;
  }

  .hero-slideshow__subheading {
    margin-top: var(--spacing-s);
  }

  .hero-slideshow__buttons {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-s);
    margin-top: var(--spacing-base);
  }

  @media (min-width: 750px) {
    .hero-slideshow__card {
      width: 50%;
    }
  }

  @media (min-width: 990px) {
    .hero-slideshow__card {
      width: 33.333%;
    }
  }

  /* Controls */
  .hero-slideshow__controls {
    display: none;
    align-items: center;
    gap: var(--spacing-s);
    position: absolute;
    bottom: var(--spacing-base);
    right: var(--spacing-base);
    z-index: 2;
    background: white;
    color: black;
    padding: var(--spacing-base);
  }

  .hero-slideshow.is-initialized .hero-slideshow__controls {
    display: flex;
  }

  .hero-slideshow__dots {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs, 8px);
  }

  .hero-slideshow__dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid currentColor;
    background: transparent;
    padding: 0;
    cursor: pointer;
    transition: background 0.2s ease;
  }

  .hero-slideshow__dot.is-active {
    background: currentColor;
  }

  .hero-slideshow__pause {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border: none;
    background: transparent;
    padding: 0;
    cursor: pointer;
    color: currentColor;
  }

  .hero-slideshow__pause .icon-play {
    display: none;
  }

  .hero-slideshow.is-paused .hero-slideshow__pause .icon-pause {
    display: none;
  }

  .hero-slideshow.is-paused .hero-slideshow__pause .icon-play {
    display: block;
  }

  /* Reduced motion: instant transitions */
  @media (prefers-reduced-motion: reduce) {
    .hero-slideshow__container {
      transition: none !important;
    }
  }
{% endstylesheet %}

<script src="{{ 'embla-carousel.umd.js' | asset_url }}" defer></script>
<script src="{{ 'hero-slideshow.js' | asset_url }}" defer></script>

{% schema %}
{
  "name": "Hero slideshow",
  "tag": "section",
  "class": "hero-slideshow-section",
  "settings": [
    {
      "type": "select",
      "id": "min_height",
      "label": "Section height",
      "options": [
        { "value": "small", "label": "Small" },
        { "value": "medium", "label": "Medium" },
        { "value": "large", "label": "Large" },
        { "value": "full", "label": "Full screen" }
      ],
      "default": "medium"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto-rotate slides",
      "default": true
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Change slides every",
      "min": 3,
      "max": 10,
      "step": 1,
      "default": 5,
      "unit": "s"
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "limit": 6,
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "video",
          "id": "video",
          "label": "Video"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Slide heading"
        },
        {
          "type": "text",
          "id": "subheading",
          "label": "Subheading"
        },
        {
          "type": "text",
          "id": "button_text",
          "label": "Button text",
          "default": "Shop now"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        },
        {
          "type": "range",
          "id": "overlay_opacity",
          "label": "Overlay opacity",
          "min": 0,
          "max": 100,
          "step": 10,
          "default": 0,
          "unit": "%"
        },
        {
          "type": "select",
          "id": "button_style",
          "label": "Button style",
          "options": [
            { "value": "primary", "label": "Primary" },
            { "value": "secondary", "label": "Secondary" }
          ],
          "default": "primary"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Hero slideshow",
      "blocks": [
        { "type": "slide" },
        { "type": "slide" }
      ]
    }
  ]
}
{% endschema %}
